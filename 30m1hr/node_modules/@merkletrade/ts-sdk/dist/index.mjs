var je=Object.defineProperty;var o=(e,t)=>je(e,"name",{value:t,configurable:!0});import{AccountAddress as oe,findFirstNonSignerArg as Ge,parseTypeTag as qe,Aptos as We,AptosConfig as se,Network as ie}from"@aptos-labs/ts-sdk";function Je(e){return e}o(Je,"dec");function He(e){return e}o(He,"dec0");function Ye(e){return e}o(Ye,"undec");function h(e,t){const n=t===void 0||t?1n:-1n;return ae(n,e)}o(h,"one");function Xe(){return 0n}o(Xe,"zero");function z(e){return e>0n?1n:-1n}o(z,"sign");function ce(e){return-e}o(ce,"neg");function ae(e,t){return t===0?e:t>0?e*10n**BigInt(t):e/10n**BigInt(-t)}o(ae,"shift");function f(e,t){return e+t}o(f,"add");function m(e,t){return e-t}o(m,"sub");function a(e,t){return e*t}o(a,"mul");function u(e,t){return e/t}o(u,"div");function Ze(e,t){return e>t}o(Ze,"gt");function ue(e,t){return e>=t}o(ue,"gte");function Ke(e,t){return e<t}o(Ke,"lt");function le(e,t){return e<=t}o(le,"lte");function pe(e,t){return e<t?e:t}o(pe,"min");function Qe(e,t){return e>t?e:t}o(Qe,"max");function de(e){return e<0n?-e:e}o(de,"abs");function M(e,t){return u(f(e,t),2n)}o(M,"avg");function E(e,t){return BigInt(Math.floor(e*10**t))}o(E,"fromNumber");function et(e,t){return Number(e)/10**t}o(et,"toNumber");function tt(e,t){if(t===0)return e.toString();const n=10n**BigInt(t),r=e<0n?-e:e,s=e<0n?"-":"",i=(r/n).toString(),c=(r%n).toString().padStart(t,"0");return`${s}${i}.${c}`}o(tt,"toFixed");const nt=o(e=>new Promise(t=>setTimeout(t,e)),"sleep"),rt=o(e=>{if(!e.stack)return e;const t=e.stack.split(`
`);return e.stack=[t[0],...t.slice(2)].join(`
`),e},"removeFirstStack"),V=o(e=>{throw e===void 0||typeof e=="string"?rt(new Error(e)):e},"raise");var k;(e=>{function t(n){return{...n,minLeverage:BigInt(n.minLeverage),maxLeverage:BigInt(n.maxLeverage),makerFee:BigInt(n.makerFee),takerFee:BigInt(n.takerFee),rolloverFeePerTimestamp:BigInt(n.rolloverFeePerTimestamp),skewFactor:BigInt(n.skewFactor),maxFundingVelocity:BigInt(n.maxFundingVelocity),maxOpenInterest:BigInt(n.maxOpenInterest),liquidateThreshold:BigInt(n.liquidateThreshold),maximumProfit:BigInt(n.maximumProfit),minimumOrderCollateral:BigInt(n.minimumOrderCollateral),minimumPositionCollateral:BigInt(n.minimumPositionCollateral),minimumPositionSize:BigInt(n.minimumPositionSize),maximumPositionCollateral:BigInt(n.maximumPositionCollateral),executionFee:BigInt(n.executionFee),maximumSkewLimit:BigInt(n.maximumSkewLimit),timestamp:new Date(n.timestamp),timestampV1:new Date(n.timestampV1),timestampV2:new Date(n.timestampV2)}}o(t,"to"),e.to=t})(k||(k={}));var v;(e=>{function t(n){return{...n,timestamp:new Date(n.timestamp),longOpenInterest:BigInt(n.longOpenInterest),shortOpenInterest:BigInt(n.shortOpenInterest),fundingRate:BigInt(n.fundingRate),accFundingFeePerSize:BigInt(n.accFundingFeePerSize),accRolloverFeePerCollateral:BigInt(n.accRolloverFeePerCollateral)}}o(t,"to"),e.to=t})(v||(v={}));var L;(e=>{function t(n){return{...n,version:+n.version,orderId:+n.orderId,uid:+n.uid,ts:new Date(n.ts)}}o(t,"to"),e.to=t})(L||(L={}));var w;(e=>{function t(n){return{...n,timestamp:new Date(n.timestamp),size:BigInt(n.size),collateral:BigInt(n.collateral),avgPrice:BigInt(n.avgPrice),accRolloverFeePerCollateral:BigInt(n.accRolloverFeePerCollateral),accFundingFeePerSize:BigInt(n.accFundingFeePerSize),stopLossTriggerPrice:BigInt(n.stopLossTriggerPrice),takeProfitTriggerPrice:BigInt(n.takeProfitTriggerPrice)}}o(t,"to"),e.to=t})(w||(w={}));var O;(e=>{function t(n){return{...n,timestamp:new Date(n.timestamp),sizeDelta:BigInt(n.sizeDelta),collateralDelta:BigInt(n.collateralDelta),price:BigInt(n.price),stopLossTriggerPrice:BigInt(n.stopLossTriggerPrice),takeProfitTriggerPrice:BigInt(n.takeProfitTriggerPrice)}}o(t,"to"),e.to=t})(O||(O={}));var B;(e=>{function t(n){return{...n,pairs:n.pairs.map(N.to)}}o(t,"to"),e.to=t})(B||(B={}));var N;(e=>{function t(n){return{...n,listingDate:n.listingDate?new Date(n.listingDate):void 0}}o(t,"to"),e.to=t})(N||(N={}));var ot="0.0.0-semantic-release";async function x(e){const{fetchFn:t,baseURL:n}=e.merkleConfig,r=await F(`${n}/v1/summary`,t);return B.to(r)}o(x,"getSummary");async function me(e){const{fetchFn:t,baseURL:n}=e.merkleConfig,r=await F(`${n}/v1/indexer/trading/pairinfo/${e.pairId}`,t);return k.to(r)}o(me,"getPairInfo");async function fe(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return(await F(`${n}/v1/indexer/trading/pairinfo`,t)).map(k.to)}o(fe,"getAllPairInfos");async function ge(e){const{fetchFn:t,baseURL:n}=e.merkleConfig,r=await F(`${n}/v1/indexer/trading/pairstate/${e.pairId}`,t);return v.to(r)}o(ge,"getPairState");async function he(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return(await F(`${n}/v1/indexer/trading/pairstate`,t)).map(v.to)}o(he,"getAllPairStates");async function Fe(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return(await F(`${n}/v1/indexer/trading/order/${e.address}`,t)).map(O.to)}o(Fe,"getOrders");async function Pe(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return(await F(`${n}/v1/indexer/trading/position/${e.address}`,t)).map(w.to)}o(Pe,"getPositions");async function ye(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return(await F(`${n}/v1/trade/${e.address}`,t)).items.map(L.to)}o(ye,"getTradingHistory");async function Ie(e){const{fetchFn:t,baseURL:n}=e.merkleConfig;return await st(`${n}/v1/feepayer/sendTransaction`,{tx:e.txHex,senderAuthenticator:e.senderAuthenticator},t)}o(Ie,"postFeepayer");const F=o(async(e,t,n)=>_e(t??fetch,"GET",e,void 0,n),"get"),st=o(async(e,t,n,r)=>_e(n??fetch,"POST",e,t,{...r,headers:{"Content-Type":"application/json"}}),"post"),_e=o(async(e,t,n,r,s)=>{const i={"Content-Type":"application/json","x-merkle-client":`merkle-ts-sdk@${ot}`,...s?.headers},c=await e(n,{...s,headers:i,method:t,body:r?JSON.stringify(r):void 0});if(!c.ok)throw new Error(`Request failed: ${c.status} ${c.statusText}`);return await c.json()},"fetchAPI"),K=class K{constructor(t){const n=t.WebSocketCtor??WebSocket;this.ws=new n(t.wsURL),this.openPromise=new Promise((r,s)=>{this.ws.addEventListener("open",()=>r()),this.ws.addEventListener("close",i=>s(new Error(`WebSocket closed: ${i.reason}`)))}),this.ws.addEventListener("message",r=>this.handleMessage(r)),this.ws.addEventListener("close",r=>this.handleClose(r)),this.subscriptions={}}async connect(){if(this.ws.readyState!==WebSocket.OPEN)return this.openPromise}disconnect(){this.ws.close()}handleMessage(t){var n;const r=JSON.parse(t.data),s=r.key,i=(n=this.subscriptions)[s]??(n[s]=[]);for(const c of i)c.enqueue(r.data)}handleClose(t){const n=Object.values(this.subscriptions).flat();for(const r of n)r.error(new Error(`WebSocket closed: ${t.reason}`));this.subscriptions={}}subscribePriceFeed(t){return this.subscribe(`price:${t}`)}subscribeAccountFeed(t){return this.subscribe(`account:${t}:events`)}subscribe(t){const n=this;let r;return new ReadableStream({async start(i){var c;r=i,n.ws.send(JSON.stringify({type:"sub",key:t})),((c=n.subscriptions)[t]??(c[t]=[])).push(i)},async cancel(){if(!r)return;const i=n.subscriptions[t]??[];n.subscriptions[t]=i.filter(c=>c!==r),i.length===0&&n.ws.send(JSON.stringify({type:"unsub",key:t})),r.close()}})}};o(K,"WSAPISession");let $=K;var S;(e=>{e.COLLATERAL=6,e.PRICE=10,e.BPS=4,e.PRECISION=6,e.FUNDING_PRECISION=8})(S||(S={}));var j;(e=>{e.mergeVersions=(t,n)=>({version:Math.max(t.versionV1,n.versionV2),timestamp:new Date(Math.max(t.timestampV1.getTime(),n.timestampV2.getTime())),...t,...n})})(j||(j={}));var G;(e=>{e.eventTypes=["cancel_order_by_user","cancel_order_max_leverage","cancel_order_under_min_leverage","cancel_order_unexecutable_market_order","cancel_order_not_enough_collateral","cancel_order_not_enough_size","cancel_order_expired","cancel_order_over_max_interest","cancel_order_over_max_collateral","cancel_order_over_max_skew_limit"]})(G||(G={}));var q;(e=>{e.eventTypes=["position_open","position_update","position_close","position_liquidate","position_take_profit","position_stop_loss"]})(q||(q={}));const ke=86400n,g=h(S.PRECISION),ve=h(S.FUNDING_PRECISION),W=h(11),it=o(({position:{avgPrice:e,size:t},increaseOrder:{sizeDelta:n},price:r})=>{if(t===0n)return r;if(n===0n)return e;const s=h(18);return u(a(f(t,n),s),f(u(a(t,s),e),u(a(n,s),r)))},"calcNewPrice"),Se=o(({position:{avgPrice:e,isLong:t},executePrice:n,decreaseOrder:{sizeDelta:r}})=>{if(e===n)return 0n;const s=m(n,e),i=u(a(u(a(s,g),e),r),g);return a(i,h(0,t))},"calcPnlWithoutFee"),Re=o(({pairInfo:{skewFactor:e},pairState:{longOpenInterest:t,shortOpenInterest:n},idxPrice:r,order:{sizeDelta:s,isLong:i,isIncrease:c}={sizeDelta:0n,isLong:!0,isIncrease:!0}})=>{if(e===0n)return r;const l=m(t,n),p=f(r,u(a(r,l),e));if(s===0n)return p;const d=f(l,a(h(0,i===c),s)),P=f(r,u(a(r,d),e));return M(p,P)},"calcPriceImpact"),be=o(({position:{collateral:e,accRolloverFeePerCollateral:t},currentAccRolloverFeePerCollateral:n})=>u(a(m(n,t),e),ve),"calcRolloverFee"),Te=o(({pairInfo:{skewFactor:e,maxFundingVelocity:t},pairState:{longOpenInterest:n,shortOpenInterest:r,fundingRate:s},timeDeltaSec:i})=>{const c=m(n,r),l=pe(e===0n?0n:u(a(c,W),e),W),p=u(a(l,t),W),d=u(a(p,i),ke);return f(s,d)},"calcFundingRate"),Ce=o(({pairState:{fundingRate:e,accFundingFeePerSize:t},currentFundingRate:n,timeDeltaSec:r})=>{const s=M(e,n),i=u(a(s,r),ke);return f(t,i)},"calcAccFundingFeePerSize"),Ae=o(({position:{size:e,isLong:t,accFundingFeePerSize:n},currentAccFundingFeePerSize:r})=>{const s=u(a(e,m(r,n)),ve);return t?s:ce(s)},"calcFundingFee"),D=o(({pairInfo:{makerFee:e,takerFee:t},pairState:{longOpenInterest:n,shortOpenInterest:r},order:{sizeDelta:s,isLong:i,isIncrease:c}})=>{const l=m(n,r),p=f(l,a(h(0,i===c),s));if(z(l)===z(p)){const Ve=i===c==l>0n;return u(a(s,Ve?t:e),g)}const d=u(a(m(s,de(l)),g),s),P=m(g,d),A=u(a(u(a(s,d),g),t),g),Me=u(a(u(a(s,P),g),e),g);return f(A,Me)},"calcMakerTakerFee"),ct=o(({pairInfo:e,pairState:t,idxPrice:n,order:r})=>{const s=Re({pairInfo:e,pairState:t,idxPrice:n,order:r}),i=m(s,n),c=n>0n?u(a(i,g),n):0n;return{price:s,priceImpact:i,priceImpactRatio:c}},"calcPriceImpactInfo"),Ee=o(({pairInfo:e,pairState:t,timestampSec:n})=>{const r=m(n,BigInt(t.lastAccrueTimestamp)),s=Te({pairInfo:e,pairState:t,timeDeltaSec:r}),i=Ce({pairState:t,currentFundingRate:s,timeDeltaSec:r});return{currentFundingRate:s,currentAccFundingFeePerSize:i}},"calcFundingInfo"),Le=o(({pairInfo:{rolloverFeePerTimestamp:e},pairState:{lastAccrueTimestamp:t,accRolloverFeePerCollateral:n},timestampSec:r})=>{const s=m(r,BigInt(t));return f(n,a(s,e))},"calcAccRolloverFeePerCollateral"),we=o(({pairInfo:e,pairState:t,position:{size:n,isLong:r}})=>D({pairInfo:e,pairState:t,order:{sizeDelta:n,isLong:r,isIncrease:!1}}),"calcExitFee"),at=o(({pairInfo:e,pairState:t,position:n,timestampSec:r})=>{const s=Le({pairInfo:e,pairState:t,timestampSec:r}),i=be({position:n,currentAccRolloverFeePerCollateral:s}),{currentAccFundingFeePerSize:c}=Ee({pairInfo:e,pairState:t,timestampSec:r}),l=Ae({position:n,currentAccFundingFeePerSize:c}),p=we({pairInfo:e,pairState:t,position:n});return{total:f(p,f(l,i)),exitFee:p,fundingFee:l,rolloverFee:i}},"calcPositionFees"),ut=o(({position:{size:e,collateral:t,isLong:n,avgPrice:r},feesTotal:s,executePrice:i})=>{const c=Se({position:{avgPrice:r,isLong:n},decreaseOrder:{sizeDelta:e},executePrice:i}),l=u(a(c,g),t),p=m(c,s),d=u(a(p,g),t);return{pnl:c,pnlRate:l,pnlWithFee:p,pnlWithFeeRate:d}},"calcPnlInfo"),lt=o((e,t,n,r,s)=>{if(e===0n)return{collateral:0n,size:0n,fee:0n};const i=a(e,E(t,0)),c=D({pairInfo:r,pairState:s,order:{sizeDelta:i,isLong:n,isIncrease:!0}}),l=m(e,c),p=a(l,E(t,0)),d=D({pairInfo:r,pairState:s,order:{sizeDelta:p,isLong:n,isIncrease:!0}}),P=m(e,d),A=a(P,E(t,0));return{collateral:e,size:A,fee:d}},"calcEntryByPaySize"),Oe=o((e,t,n,r)=>{const s=o((p,d)=>p?d?1n:-1n:d?-1n:1n,"signed"),i=h(4)+s(t,n)*r,c=a(e,i),l=u(c,h(4));return le(l,I)?I:ue(l,y)?y:l},"calcSlippagePrice"),y=2n**64n-1n,I=1n;function Be(e){const t=e.slippage?Oe(e.slippage.markPrice,e.isIncrease,e.isLong,e.slippage.slippageBps):void 0;return xe({...e,price:t,isMarket:!0})}o(Be,"placeMarketOrder");function Ne(e){return xe({...e,isMarket:!1})}o(Ne,"placeLimitOrder");function xe(e){const t=e.summary.hostAddress,n=J(e.pair,t),r=H(e.summary);return{function:`${t}::managed_trading::place_order_v3`,typeArguments:[n,r],functionArguments:[e.userAddress,e.sizeDelta,e.collateralDelta,e.price??(e.isLong?y:I),e.isLong,e.isIncrease,e.isMarket,e.stopLossTriggerPrice??(e.isLong?I:y),e.takeProfitTriggerPrice??(e.isLong?y:I),e.canExecuteAbovePrice??!e.isLong,e.referrer??oe.ZERO],abi:Y({generic_type_params:[{constraints:[]},{constraints:[]}],params:["&signer","address","u64","u64","u64","bool","bool","bool","u64","u64","bool","address"]})}}o(xe,"placeOrderV3");function $e(e){const t=e.summary.hostAddress,n=J(e.pair,t),r=H(e.summary);return{function:`${t}::managed_trading::cancel_order_v3`,typeArguments:[n,r],functionArguments:[e.userAddress,e.orderId],abi:Y({generic_type_params:[{constraints:[]},{constraints:[]}],params:["&signer","address","u64"]})}}o($e,"cancelOrder");function De(e){const t=e.summary.hostAddress,n=J(e.pair,t),r=H(e.summary);return{function:`${t}::managed_trading::update_position_tp_sl_v3`,typeArguments:[n,r],functionArguments:[e.userAddress,e.isLong,e.takeProfitTriggerPrice,e.stopLossTriggerPrice],abi:Y({generic_type_params:[{constraints:[]},{constraints:[]}],params:["&signer","address","bool","u64","u64"]})}}o(De,"updateTPSL");function Ue(e){return{function:`${e.summary.hostAddress}::test_trading::faucet_native_usdc`,functionArguments:[e.amount]}}o(Ue,"testnetFaucetUSDC");function J(e,t){return e.includes("::")?e:`${t}::pair_types::${e}`}o(J,"resolvePairType");function H(e){return e.coins.find(t=>t.id==="usdc")?.coinType??V()}o(H,"usdcCollateralType");const Y=o(e=>{const t=Ge(e),n=e.params.slice(t).map(s=>qe(s,{allowGenerics:!0}));return{typeParameters:e.generic_type_params,parameters:n,signers:t}},"parseAbi");async function ze(e){const t=new We(e.aptosConfig),n=e.summary.coins.find(s=>s.id==="usdc")??V(),r=await t.getCurrentFungibleAssetBalances({options:{where:{owner_address:{_eq:oe.from(e.accountAddress).toStringLong()},asset_type:{_eq:n.assetType}}}});return r.length===0?0n:BigInt(r[0].amount)}o(ze,"getUsdcBalance");const Q=class Q{constructor(t){this.config=t}async getSummary(){return x(this.config)}async getPairInfo(t){return me({...this.config,...t})}async getAllPairInfos(){return fe(this.config)}async getPairState(t){return ge({...this.config,...t})}async getAllPairStates(){return he(this.config)}async getOrders(t){return Fe({...this.config,...t})}async getPositions(t){return Pe({...this.config,...t})}async getTradingHistory(t){return ye({...this.config,...t})}async postFeepayer(t){return Ie({...this.config,...t})}};o(Q,"APIClient");let R=Q;const ee=class ee{constructor(t){this.config=t}async connectWsApi(t){const n=new $({wsURL:this.config.merkleConfig.wsURL,...t});return await n.connect(),n}};o(ee,"WSAPIClient");let b=ee;const te=class te{constructor(t){this.config=t}async getUsdcBalance(t){return ze({...this.config,...t})}};o(te,"AptosHelpers");let T=te;const ne=class ne{constructor(t){this.config=t}placeMarketOrder(t){return Be({...this.config,...t})}placeLimitOrder(t){return Ne({...this.config,...t})}cancelOrder(t){return $e({...this.config,...t})}updateTPSL(t){return De({...this.config,...t})}testnetFaucetUSDC(t){return Ue({...this.config,...t})}};o(ne,"MerklePayloadBuilder");let U=ne;var C;(e=>{e.MAINNET={baseURL:"https://api.merkle.trade",wsURL:"wss://api.merkle.trade/v1"},e.TESTNET={baseURL:"https://api.testnet.merkle.trade",wsURL:"wss://api.testnet.merkle.trade/v1"}})(C||(C={}));var X;(e=>{const t="0x5ae6789dd2fec1a9ec9cccfb3acaf12e93d432f0a3a42c92fe1a9d490b7bbc06";e.mainnet=async n=>{const r=n?.merkleConfig??C.MAINNET,s=n?.aptosConfig??new se({network:ie.MAINNET}),i=n?.summary??await x({merkleConfig:r});if(i.hostAddress!==t)throw new Error("Invalid deployer address");return{merkleConfig:r,aptosConfig:s,summary:i}},e.testnet=async n=>{const r=n?.merkleConfig??C.TESTNET,s=n?.aptosConfig??new se({network:ie.TESTNET}),i=n?.summary??await x({merkleConfig:r});return{merkleConfig:r,aptosConfig:s,summary:i}}})(X||(X={}));const re=class re{constructor(t){this.config=t,this.api=new R(this.config),this.wsapi=new b(this.config),this.payloads=new U(this.config),this.aptos=new T(this.config)}};o(re,"MerkleClient");let _=re;function Z(e,t,n){Object.getOwnPropertyNames(t.prototype).forEach(r=>{const s=Object.getOwnPropertyDescriptor(t.prototype,r);s&&(s.value=function(...i){return this[n][r](...i)},Object.defineProperty(e.prototype,r,s))})}o(Z,"applyMixin"),Z(_,R,"api"),Z(_,b,"wsapi"),Z(_,T,"aptos");export{R as APIClient,T as AptosHelpers,G as CancelOrderEvent,S as Decimals,_ as MerkleClient,X as MerkleClientConfig,C as MerkleConfig,U as MerklePayloadBuilder,g as PRECISION,y as PRICE_MAX,I as PRICE_MIN,j as PairInfo,q as PositionEvent,O as RawOrder,k as RawPairInfoResponse,v as RawPairStateResponse,w as RawPosition,N as RawSummaryPair,B as RawSummaryResponse,L as RawTradeHistory,b as WSAPIClient,$ as WSAPISession,de as abs,f as add,M as avg,Ce as calcAccFundingFeePerSize,Le as calcAccRolloverFeePerCollateral,lt as calcEntryByPaySize,we as calcExitFee,Ae as calcFundingFee,Ee as calcFundingInfo,Te as calcFundingRate,D as calcMakerTakerFee,it as calcNewPrice,ut as calcPnlInfo,Se as calcPnlWithoutFee,at as calcPositionFees,Re as calcPriceImpact,ct as calcPriceImpactInfo,be as calcRolloverFee,Oe as calcSlippagePrice,$e as cancelOrder,Je as dec,He as dec0,u as div,E as fromNumber,fe as getAllPairInfos,he as getAllPairStates,Fe as getOrders,me as getPairInfo,ge as getPairState,Pe as getPositions,x as getSummary,ye as getTradingHistory,ze as getUsdcBalance,Ze as gt,ue as gte,Ke as lt,le as lte,Qe as max,pe as min,a as mul,ce as neg,h as one,Ne as placeLimitOrder,Be as placeMarketOrder,Ie as postFeepayer,V as raise,ae as shift,z as sign,nt as sleep,m as sub,Ue as testnetFaucetUSDC,tt as toFixed,et as toNumber,Ye as undec,De as updateTPSL,Xe as zero};
//# sourceMappingURL=index.mjs.map
